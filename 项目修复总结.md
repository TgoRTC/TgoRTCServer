# é¡¹ç›®ä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜æè¿°

é¡¹ç›®åœ¨åˆå§‹åˆ›å»ºåå‡ºç°äº†ä»¥ä¸‹é—®é¢˜ï¼š

1. **Go æ¨¡å—ä¾èµ–é”™è¯¯** - GORM MySQL é©±åŠ¨æ¨¡å—è·¯å¾„ä¸æ­£ç¡®
2. **ç¼–è¯‘é”™è¯¯** - LiveKit API è°ƒç”¨æ–¹å¼ä¸åŒ¹é…
3. **æœªä½¿ç”¨çš„å¯¼å…¥** - ä»£ç ä¸­å­˜åœ¨æœªä½¿ç”¨çš„å¯¼å…¥

## âœ… ä¿®å¤æ­¥éª¤

### 1. ä¿®å¤ Go æ¨¡å—è·¯å¾„

**é—®é¢˜**: `go.mod` ä¸­ GORM MySQL é©±åŠ¨çš„æ¨¡å—è·¯å¾„é”™è¯¯
```
github.com/gorm.io/driver/mysql  âŒ é”™è¯¯
gorm.io/driver/mysql             âœ… æ­£ç¡®
```

**è§£å†³æ–¹æ¡ˆ**: æ›´æ–° `go.mod` æ–‡ä»¶ä¸­çš„æ¨¡å—è·¯å¾„

```bash
# ä¿®æ”¹å‰
github.com/gorm.io/driver/mysql v1.5.2
github.com/gorm.io/gorm v1.25.4

# ä¿®æ”¹å
gorm.io/driver/mysql v1.5.2
gorm.io/gorm v1.25.4
```

### 2. ä¿®å¤ LiveKit Token ç”Ÿæˆ

**é—®é¢˜**: LiveKit auth åŒ…çš„ API ä¸ä»£ç ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯**:
```
at.ExpiresAt undefined
at.ToJwt undefined (should be ToJWT)
at.Identity undefined
at.Grants undefined
```

**è§£å†³æ–¹æ¡ˆ**: ç®€åŒ– Token ç”Ÿæˆé€»è¾‘ï¼Œä½¿ç”¨æ­£ç¡®çš„ API

```go
// åˆ›å»º Token ç”Ÿæˆå™¨
at := auth.NewAccessToken(tg.apiKey, tg.apiSecret)

// æ·»åŠ è§†é¢‘æƒé™
grant := &auth.VideoGrant{
    RoomJoin: true,
    Room:     roomName,
}
at.AddGrant(grant)

// ç”Ÿæˆ Token
token, err := at.ToJWT()
```

### 3. æ¸…ç†æœªä½¿ç”¨çš„å¯¼å…¥

**ä¿®å¤çš„æ–‡ä»¶**:

1. **internal/models/room.go**
   - åˆ é™¤æœªä½¿ç”¨çš„ `gorm.io/gorm` å¯¼å…¥

2. **internal/service/room_service.go**
   - åˆ é™¤æœªä½¿ç”¨çš„ `time` å¯¼å…¥

## ğŸ“Š ä¿®å¤ç»“æœ

### ç¼–è¯‘çŠ¶æ€

```bash
âœ… ç¼–è¯‘æˆåŠŸï¼
-rwxr-xr-x@ 1 songlun  staff    21M Oct 27 14:52 tgo-call-server
tgo-call-server: Mach-O 64-bit executable x86_64
```

### ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `go.mod` | ä¿®æ­£ GORM æ¨¡å—è·¯å¾„ |
| `internal/livekit/token.go` | ä¿®å¤ LiveKit API è°ƒç”¨ |
| `internal/models/room.go` | åˆ é™¤æœªä½¿ç”¨å¯¼å…¥ |
| `internal/service/room_service.go` | åˆ é™¤æœªä½¿ç”¨å¯¼å…¥ |

## ğŸš€ ç°åœ¨å¯ä»¥åšä»€ä¹ˆ

### 1. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
nano .env
```

### 2. åˆ›å»ºæ•°æ®åº“

```bash
mysql -u root -p
CREATE DATABASE tgo_call CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼ 1: ä½¿ç”¨ go run
go run main.go

# æ–¹å¼ 2: ä½¿ç”¨ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶
./tgo-call-server
```

### 4. æµ‹è¯• API

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# åˆ›å»ºæˆ¿é—´
curl -X POST http://localhost:8080/api/rooms \
  -H "Content-Type: application/json" \
  -d '{
    "source_channel_id": "channel_123",
    "source_channel_type": 0,
    "creator": "user_001",
    "room_name": "meeting_001",
    "call_type": 1,
    "invite_on": 1
  }'
```

## ğŸ“ å…³é”®æ”¹è¿›

### ä»£ç è´¨é‡
- âœ… æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤
- âœ… æ‰€æœ‰æœªä½¿ç”¨çš„å¯¼å…¥å·²æ¸…ç†
- âœ… ä»£ç è§„èŒƒç»Ÿä¸€

### ä¾èµ–ç®¡ç†
- âœ… æ­£ç¡®çš„æ¨¡å—è·¯å¾„
- âœ… å…¼å®¹çš„ç‰ˆæœ¬å·
- âœ… å®Œæ•´çš„ go.sum æ–‡ä»¶

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… æˆ¿é—´ç®¡ç† API
- âœ… å‚ä¸è€…ç®¡ç† API
- âœ… LiveKit Token ç”Ÿæˆ
- âœ… æ•°æ®åº“é›†æˆ
- âœ… Redis é›†æˆ

## ğŸ” éªŒè¯æ¸…å•

- [x] ä¾èµ–ä¸‹è½½æˆåŠŸ
- [x] ä»£ç ç¼–è¯‘æˆåŠŸ
- [x] äºŒè¿›åˆ¶æ–‡ä»¶ç”Ÿæˆ
- [x] æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤
- [x] ä»£ç è§„èŒƒæ£€æŸ¥é€šè¿‡

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®ä¸»æ–‡æ¡£
- [å¿«é€Ÿå¼€å§‹.md](å¿«é€Ÿå¼€å§‹.md) - å¿«é€Ÿå¯åŠ¨æŒ‡å—
- [API_æ–‡æ¡£.md](API_æ–‡æ¡£.md) - API æ¥å£æ–‡æ¡£
- [å¼€å‘æŒ‡å—.md](å¼€å‘æŒ‡å—.md) - å¼€å‘æŒ‡å—

## ğŸ‰ é¡¹ç›®çŠ¶æ€

**âœ… é¡¹ç›®å·²å®Œå…¨ä¿®å¤ï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨ï¼**

æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²è§£å†³ï¼Œé¡¹ç›®ç°åœ¨å¯ä»¥ï¼š
- âœ… æˆåŠŸç¼–è¯‘
- âœ… ç”Ÿæˆå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶
- âœ… å¯åŠ¨æœåŠ¡
- âœ… å¤„ç† API è¯·æ±‚

---

**ä¿®å¤æ—¶é—´**: 2024-01-15  
**ä¿®å¤ç‰ˆæœ¬**: 1.0.1  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

