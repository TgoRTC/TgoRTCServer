# å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### å‰ç½®è¦æ±‚

- Go 1.21+
- MySQL 5.7+
- Redis 5.0+
- LiveKit æœåŠ¡å™¨

### ç¬¬ 1 æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼ˆæ ¹æ®ä½ çš„ç¯å¢ƒä¿®æ”¹ï¼‰
nano .env
```

**æœ€å°é…ç½®ç¤ºä¾‹**:
```bash
PORT=8080
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=tgo_call
REDIS_HOST=localhost
REDIS_PORT=6379
LIVEKIT_API_KEY=your_api_key
LIVEKIT_API_SECRET=your_api_secret
```

### ç¬¬ 2 æ­¥ï¼šåˆ›å»ºæ•°æ®åº“

```bash
mysql -u root -p
```

```sql
CREATE DATABASE tgo_call CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### ç¬¬ 3 æ­¥ï¼šå®‰è£…ä¾èµ–

```bash
go mod download
```

### ç¬¬ 4 æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
go run main.go
```

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š
```
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… æ•°æ®åº“è¿ç§»å®Œæˆ
âœ… Redis è¿æ¥æˆåŠŸ
ğŸš€ éŸ³è§†é¢‘æœåŠ¡å¯åŠ¨åœ¨ç«¯å£ 8080
```

### ç¬¬ 5 æ­¥ï¼šæµ‹è¯• API

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# åˆ›å»ºæˆ¿é—´
curl -X POST http://localhost:8080/api/rooms \
  -H "Content-Type: application/json" \
  -d '{
    "source_channel_id": "channel_123",
    "source_channel_type": 0,
    "creator": "user_001",
    "room_name": "meeting_001",
    "call_type": 1,
    "invite_on": 1
  }'
```

## ğŸ“š å®Œæ•´æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [API_æ–‡æ¡£.md](API_æ–‡æ¡£.md) | ğŸ“– å®Œæ•´çš„ API æ¥å£æ–‡æ¡£ |
| [å¼€å‘æŒ‡å—.md](å¼€å‘æŒ‡å—.md) | ğŸ› ï¸ æœ¬åœ°å¼€å‘ç¯å¢ƒå’Œå¼€å‘æŒ‡å— |
| [é¡¹ç›®ç»“æ„è¯´æ˜.md](é¡¹ç›®ç»“æ„è¯´æ˜.md) | ğŸ—ï¸ é¡¹ç›®æ¶æ„å’Œæ¨¡å—è¯´æ˜ |
| [æ•°æ®åº“å­—æ®µè¯´æ˜.md](æ•°æ®åº“å­—æ®µè¯´æ˜.md) | ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„è¯´æ˜ |
| [é¡¹ç›®åˆ›å»ºæ€»ç»“.md](é¡¹ç›®åˆ›å»ºæ€»ç»“.md) | ğŸ“‹ é¡¹ç›®åˆ›å»ºæ€»ç»“ |
| [é¡¹ç›®éªŒè¯æ¸…å•.md](é¡¹ç›®éªŒè¯æ¸…å•.md) | âœ… é¡¹ç›®éªŒè¯æ¸…å• |

## ğŸ¯ å¸¸è§ä»»åŠ¡

### åˆ›å»ºæˆ¿é—´

```bash
curl -X POST http://localhost:8080/api/rooms \
  -H "Content-Type: application/json" \
  -d '{
    "source_channel_id": "channel_123",
    "source_channel_type": 0,
    "creator": "user_001",
    "room_name": "meeting_001",
    "call_type": 1,
    "invite_on": 1
  }'
```

**å“åº”**:
```json
{
  "code": 0,
  "msg": "æˆ¿é—´åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "room_name": "meeting_001",
    "token": "eyJhbGc...",
    "livekit_url": "http://localhost:7880",
    "status": 0,
    "created_at": "2024-01-15T10:30:00Z"
  }
}
```

### åŠ å…¥æˆ¿é—´

```bash
curl -X POST http://localhost:8080/api/participants/join \
  -H "Content-Type: application/json" \
  -d '{
    "room_name": "meeting_001",
    "uid": "user_002"
  }'
```

### è·å–æˆ¿é—´ä¿¡æ¯

```bash
curl http://localhost:8080/api/rooms/meeting_001
```

### è·å–å‚ä¸è€…åˆ—è¡¨

```bash
curl http://localhost:8080/api/rooms/meeting_001/participants
```

### ç¦»å¼€æˆ¿é—´

```bash
curl -X POST http://localhost:8080/api/participants/leave \
  -H "Content-Type: application/json" \
  -d '{
    "room_name": "meeting_001",
    "uid": "user_002"
  }'
```

## ğŸ”§ å¸¸è§é—®é¢˜

### æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `æ•°æ®åº“è¿æ¥å¤±è´¥`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ MySQL æ˜¯å¦è¿è¡Œ: `mysql -u root -p`
2. æ£€æŸ¥ `.env` ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨: `CREATE DATABASE tgo_call;`

### Redis è¿æ¥å¤±è´¥

**é”™è¯¯**: `Redis è¿æ¥å¤±è´¥`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Redis æ˜¯å¦è¿è¡Œ: `redis-cli ping`
2. æ£€æŸ¥ `.env` ä¸­çš„ Redis é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ Redis å¯†ç æ˜¯å¦æ­£ç¡®

### LiveKit Token ç”Ÿæˆå¤±è´¥

**é”™è¯¯**: `ç”Ÿæˆ Token å¤±è´¥`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `.env` ä¸­çš„ `LIVEKIT_API_KEY` å’Œ `LIVEKIT_API_SECRET` æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ LiveKit æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ

### ç«¯å£è¢«å ç”¨

**é”™è¯¯**: `listen tcp :8080: bind: address already in use`

**è§£å†³æ–¹æ¡ˆ**:
1. ä¿®æ”¹ `.env` ä¸­çš„ `PORT` ä¸ºå…¶ä»–ç«¯å£
2. æˆ–è€…æ€æ­»å ç”¨è¯¥ç«¯å£çš„è¿›ç¨‹: `lsof -i :8080`

## ğŸ“Š é¡¹ç›®ç»“æ„

```
tgo-call-server/
â”œâ”€â”€ main.go                          # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ go.mod                           # Go æ¨¡å—å®šä¹‰
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/                      # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database/                    # æ•°æ®åº“å’Œ Redis
â”‚   â”œâ”€â”€ models/                      # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ service/                     # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ handler/                     # API å¤„ç†å™¨
â”‚   â”œâ”€â”€ livekit/                     # LiveKit é›†æˆ
â”‚   â””â”€â”€ router/                      # è·¯ç”±é…ç½®
â””â”€â”€ æ–‡æ¡£æ–‡ä»¶/
    â”œâ”€â”€ API_æ–‡æ¡£.md
    â”œâ”€â”€ å¼€å‘æŒ‡å—.md
    â”œâ”€â”€ é¡¹ç›®ç»“æ„è¯´æ˜.md
    â””â”€â”€ ...
```

## ğŸŒ API ç«¯ç‚¹

### æˆ¿é—´ç®¡ç†
- `POST /api/rooms` - åˆ›å»ºæˆ¿é—´
- `GET /api/rooms` - åˆ—å‡ºæˆ¿é—´åˆ—è¡¨
- `GET /api/rooms/:room_name` - è·å–æˆ¿é—´ä¿¡æ¯
- `PUT /api/rooms/:room_name/status` - æ›´æ–°æˆ¿é—´çŠ¶æ€
- `POST /api/rooms/:room_name/end` - ç»“æŸæˆ¿é—´

### å‚ä¸è€…ç®¡ç†
- `POST /api/participants/join` - åŠ å…¥æˆ¿é—´
- `POST /api/participants/leave` - ç¦»å¼€æˆ¿é—´
- `GET /api/rooms/:room_name/participants` - è·å–å‚ä¸è€…åˆ—è¡¨
- `POST /api/rooms/:room_name/invite` - é‚€è¯·å‚ä¸è€…
- `PUT /api/rooms/:room_name/participants/:uid/status` - æ›´æ–°å‚ä¸è€…çŠ¶æ€

### å…¶ä»–
- `GET /health` - å¥åº·æ£€æŸ¥

## ğŸ’¡ æç¤º

### ä½¿ç”¨ Postman æµ‹è¯•

1. æ‰“å¼€ Postman
2. åˆ›å»ºæ–°çš„ Request
3. é€‰æ‹© HTTP æ–¹æ³•ï¼ˆGET/POST/PUTï¼‰
4. è¾“å…¥ URL: `http://localhost:8080/api/...`
5. æ·»åŠ  JSON è¯·æ±‚ä½“ï¼ˆå¦‚éœ€è¦ï¼‰
6. ç‚¹å‡» Send

### æŸ¥çœ‹æ—¥å¿—

ä¿®æ”¹ `.env` ä¸­çš„ `LOG_LEVEL`:
```bash
LOG_LEVEL=debug
```

### è°ƒè¯•æ•°æ®åº“

```bash
# è¿æ¥æ•°æ®åº“
mysql -u root -p tgo_call

# æŸ¥çœ‹æˆ¿é—´è¡¨
SELECT * FROM livekit_room;

# æŸ¥çœ‹å‚ä¸è€…è¡¨
SELECT * FROM livekit_participant;
```

### è°ƒè¯• Redis

```bash
# è¿æ¥ Redis
redis-cli

# æŸ¥çœ‹æ‰€æœ‰é”®
KEYS *

# æŸ¥çœ‹ç‰¹å®šé”®çš„å€¼
GET key_name
```

## ğŸš€ ä¸‹ä¸€æ­¥

1. **é˜…è¯» API æ–‡æ¡£**: [API_æ–‡æ¡£.md](API_æ–‡æ¡£.md)
2. **å­¦ä¹ é¡¹ç›®ç»“æ„**: [é¡¹ç›®ç»“æ„è¯´æ˜.md](é¡¹ç›®ç»“æ„è¯´æ˜.md)
3. **å¼€å§‹å¼€å‘**: [å¼€å‘æŒ‡å—.md](å¼€å‘æŒ‡å—.md)
4. **éƒ¨ç½²åˆ°ç”Ÿäº§**: [éƒ¨ç½²æ¶æ„æŒ‡å—.md](éƒ¨ç½²æ¶æ„æŒ‡å—.md)

## ğŸ“ è·å–å¸®åŠ©

- æŸ¥çœ‹ [éƒ¨ç½²å¸¸è§é—®é¢˜.md](éƒ¨ç½²å¸¸è§é—®é¢˜.md)
- æŸ¥çœ‹ [å¼€å‘æŒ‡å—.md](å¼€å‘æŒ‡å—.md) ä¸­çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
- æŸ¥çœ‹ [é¡¹ç›®éªŒè¯æ¸…å•.md](é¡¹ç›®éªŒè¯æ¸…å•.md)

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

